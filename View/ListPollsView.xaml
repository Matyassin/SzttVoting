<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="View.ListPollsView"
             xmlns:DataType="clr-namespace:ViewModel;assembly=ViewModel"
             xmlns:Converters="clr-namespace:ViewModel.Converter;assembly=ViewModel">
    <ContentPage.Resources>
        <Converters:IsNotNullConverter x:Key="IsNotNullConverter"/>
    </ContentPage.Resources>
        <Border BackgroundColor="SlateGray" 
                StrokeShape="RoundRectangle 40"
                Margin="50"
                StrokeThickness="2">
        <Grid ColumnDefinitions="30*, 70*" Margin="20">
            <Border Grid.Column="0"
                BackgroundColor="DarkSlateGray"
                    StrokeShape="RoundRectangle 40"
                    StrokeThickness="2"
                    Padding="25">
                <ScrollView>
                <VerticalStackLayout>

                
                    <!-- MY VOTES -->
                    <VerticalStackLayout Spacing="10">
                        
                        <Label Text="My Votes"
                               FontSize="26"
                               TextColor="White"
                               HorizontalOptions="Center"/>
                        <Border StrokeThickness="1"/>
                        <CollectionView ItemsSource="{Binding UserPolls}"
                                        SelectionMode="Single"
                                        SelectedItem="{Binding SelectedPoll, Mode=TwoWay}">
                            
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Border StrokeShape="RoundRectangle 20"
                                            StrokeThickness="1"
                                            Stroke="black"
                                            BackgroundColor="SlateGray"
                                            Margin="10"
                                            Padding="20">

                                        <Grid ColumnDefinitions="*, Auto, Auto">
                                            <VerticalStackLayout Grid.Column="0">
                                                <Label Text="{Binding Title}"
                                                       FontSize="18"
                                                       TextColor="White"/>

                                                <Label Text="{Binding Description}"
                                                       FontSize="14"
                                                       TextColor="White"/>

                                                <Label Text="{Binding Created, StringFormat='Created: {0}'}"
                                                       FontSize="14"
                                                       TextColor="White"/>

                                                <Label Text="{Binding Deadline, StringFormat='Deadline: {0}'}"
                                                       FontSize="14"
                                                       TextColor="White"/>

                                            </VerticalStackLayout>

                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>

                
                    <!-- OTHER VOTES -->
                    <VerticalStackLayout Spacing="20">
                        <Label Text="Other Votes"
                               FontSize="26"
                               TextColor="White"
                               Padding="20,0,0,0"/>

                        <CollectionView ItemsSource="{Binding OtherPolls}"
                                        SelectionMode="Single"
                                        SelectedItem="{Binding SelectedPoll, Mode=TwoWay}">
                            
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Border StrokeShape="RoundRectangle 40"
                                            StrokeThickness="0"
                                            HorizontalOptions="Center"
                                            VerticalOptions="Center"
                                            Padding="25"
                                            BackgroundColor="SlateGray">
                                    
                                        <Border.Shadow>
                                            <Shadow Brush="Black"
                                                    Offset="0,15"
                                                    Radius="40"
                                                    Opacity="0.4" />
                                        </Border.Shadow>

                                        <Grid ColumnDefinitions="*, Auto, Auto">
                                            <VerticalStackLayout Grid.Column="0">
                                                <Label Text="{Binding Title}"
                                                       FontSize="18"
                                                       TextColor="White"/>

                                                <Label Text="{Binding Description}"
                                                       FontSize="14"
                                                       TextColor="White"/>

                                                <Label Text="{Binding Deadline, StringFormat='Deadline: {0}'}"
                                                       FontSize="14"
                                                       TextColor="White"/>


                                            </VerticalStackLayout>
                                            
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>

                
                    <!-- ARCHIVED VOTES -->
                    <VerticalStackLayout Spacing="20">
                        <Label Text="Archived Votes"
                                FontSize="26"
                                TextColor="White"
                                Padding="20,0,0,0"/>

                        <CollectionView ItemsSource="{Binding ArchivedVotes}"
                                        SelectionMode="Single"
                                        SelectedItem="{Binding SelectedPoll, Mode=TwoWay}">
                            
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Border StrokeShape="RoundRectangle 40"
                                             StrokeThickness="0"
                                             HorizontalOptions="Center"
                                             VerticalOptions="Center"
                                             Padding="25"
                                             BackgroundColor="SlateGray">

                                        <Border.Shadow>
                                            <Shadow Brush="Black"
                                                     Offset="0,15"
                                                     Radius="40"
                                                     Opacity="0.4" />
                                        </Border.Shadow>

                                        <Grid ColumnDefinitions="*, Auto, Auto">
                                            <VerticalStackLayout Grid.Column="0">
                                                <Label Text="{Binding Title}"
                                                        FontSize="18"
                                                        TextColor="White"/>

                                                <Label Text="{Binding Description}"
                                                        FontSize="14"
                                                        TextColor="White"/>

                                            </VerticalStackLayout>

                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </ScrollView>
            </Border>

            <!-- RIGHT SIDE -->
            <!-- IsVisible = {Binding. , Converter={StaticResource IsNotNullConverter}} -->

            <VerticalStackLayout Grid.Column="2">

                
                
                <VerticalStackLayout Grid.Column="1"
                                     BindingContext="{Binding SelectedPoll}"
                                     IsVisible="{Binding ., Converter={StaticResource IsNotNullConverter}}">
                    

                    <Border StrokeShape="RoundRectangle 40"
                            Stroke="Black"
                            Padding="20"
                            Margin="10">

                        <VerticalStackLayout Spacing="15">
                            <Label Text="Selected Poll"
                                   FontSize="24"
                                   Padding="20"
                                   TextColor="White"/>
                            <Border StrokeThickness="1" Stroke="Black"/>
                            
                            <Label Text="{Binding Title}"
                                   FontSize="50"
                                   TextColor="White"
                                   HorizontalOptions="Start"/>
                            <Label Text="{Binding Description, StringFormat='Description: {0}'}" 
                                   HorizontalOptions="Start"
                                   FontAttributes="Italic"/>
                            <Label Text="{Binding Created, StringFormat='Created: {0}'}"
                                   FontSize="14"
                                   TextColor="White"/>

                            <Label Text="{Binding Deadline, StringFormat='Deadline: {0}'}"
                                   FontSize="14"
                                   TextColor="White"/>
                            <Border StrokeThickness="1"
                                    Stroke="Black"/>
                            <StackLayout>
                                <HorizontalStackLayout BindableLayout.ItemsSource="{Binding Options}"
                                                        Spacing="10"
                                                        HorizontalOptions="Start">
                                    <BindableLayout.ItemTemplate>
                                        <DataTemplate>
                                            <Border StrokeThickness="0"
                                                    StrokeShape="RoundRectangle 40"
                                                    Stroke="Black"
                                                    BackgroundColor="Black" >
                                                <RadioButton Content="{Binding Text}" 
                                                             HorizontalOptions="Center" 
                                                             VerticalOptions="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </BindableLayout.ItemTemplate>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout HorizontalOptions="End">
                                    <Button Text="Save Your Vote!" />
                                </HorizontalStackLayout>
                            </StackLayout>
                     </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>
            </VerticalStackLayout>
        </Grid>
    </Border>
</ContentPage>
