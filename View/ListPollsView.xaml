<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="View.ListPollsView"
             xmlns:ViewModels="clr-namespace:ViewModel;assembly=ViewModel"
             xmlns:Converters="clr-namespace:ViewModel.Converter;assembly=ViewModel">
    
    <ContentPage.Resources>
        <Converters:IsNotNullConverter x:Key="IsNotNullConverter"/>
        <Converters:RemainingTimeConverter x:Key="RemainingTimeCoverter"/>
    </ContentPage.Resources>
    
        <Border BackgroundColor="SlateGray" 
                StrokeShape="RoundRectangle 40"
                Margin="50"
                StrokeThickness="2">
            
        <Grid ColumnDefinitions="30*, 70*"
              Margin="20">

            <!-- LEFT SIDE -->
            <Border Grid.Column="0"
                    BackgroundColor="#20FFFFFF"
                    StrokeShape="RoundRectangle 40"
                    Padding="25"
                    StrokeThickness="0">
                
            <ScrollView>
                <VerticalStackLayout Spacing="50">

                    <!-- MY VOTES -->
                    <VerticalStackLayout Spacing="10">
                        
                        <Label Text="My Votes"
                               FontSize="26"
                               TextColor="White"
                               HorizontalOptions="Center"/>
                        
                        <Border StrokeThickness="1"/>
                        
                        <CollectionView ItemsSource="{Binding UserPolls}"
                                        SelectionMode="Single"
                                        SelectedItem="{Binding SelectedPoll, Mode=TwoWay}">
                            
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Border StrokeShape="RoundRectangle 20"
                                            StrokeThickness="2"
                                            Margin="10"
                                            Padding="20"
                                            BackgroundColor="SlateGray"
                                            Stroke="Transparent">

                                        
                                        <!-- NEED THIS FOR SELECTION HIGHLIGHT LOGIC -->
                                        <VisualStateManager.VisualStateGroups>
                                            <VisualStateGroup Name="CommonStates">
                                                <VisualState Name="Normal">
                                                    <VisualState.Setters>
                                                        <Setter Property="Stroke" Value="Transparent"/>
                                                    </VisualState.Setters>
                                                </VisualState>

                                                <VisualState Name="Selected">
                                                    <VisualState.Setters>
                                                        <Setter Property="Stroke" Value="BlueViolet"/>
                                                    </VisualState.Setters>
                                                </VisualState>
                                            </VisualStateGroup>
                                        </VisualStateManager.VisualStateGroups>

                                        
                                        <Grid ColumnDefinitions="*, Auto, Auto">
                                            <VerticalStackLayout Grid.Column="0">
                                                <Label Text="{Binding Title}"
                                                        FontSize="18"
                                                        TextColor="White"/>

                                                <Label Text="{Binding Deadline, Converter={StaticResource RemainingTimeCoverter}}"
                                                        FontSize="14"
                                                        TextColor="White"/>

                                            </VerticalStackLayout>

                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>

                
                    <!-- OTHER VOTES -->
                    <VerticalStackLayout Spacing="10">
                        
                        <Label Text="Other Votes"
                               FontSize="26"
                               TextColor="White"
                               HorizontalOptions="Center"/>
                        <Border StrokeThickness="1"/>
                        <CollectionView ItemsSource="{Binding OtherPolls}"
                                        SelectionMode="Single"
                                        SelectedItem="{Binding SelectedPoll, Mode=TwoWay}">
                            
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Border StrokeShape="RoundRectangle 20"
                                            StrokeThickness="2"
                                            Margin="10"
                                            Padding="20"
                                            BackgroundColor="SlateGray"
                                            Stroke="Transparent">


                                        <!-- WE NEED THIS FOR SELECTION HIGHLIGHT LOGIC -->
                                        <VisualStateManager.VisualStateGroups>
                                            <VisualStateGroup Name="CommonStates">
                                                <VisualState Name="Normal">
                                                    <VisualState.Setters>
                                                        <Setter Property="Stroke" Value="Transparent"/>
                                                    </VisualState.Setters>
                                                </VisualState>

                                                <VisualState Name="Selected">
                                                    <VisualState.Setters>
                                                        <Setter Property="Stroke" Value="BlueViolet"/>
                                                    </VisualState.Setters>
                                                </VisualState>
                                            </VisualStateGroup>
                                        </VisualStateManager.VisualStateGroups>
                                        

                                        <Grid ColumnDefinitions="*, Auto, Auto">
                                            <VerticalStackLayout Grid.Column="0">
                                                <Label Text="{Binding Title}"
                                                       FontSize="18"
                                                       TextColor="White"/>

                                                <Label Text="{Binding Deadline, Converter={StaticResource RemainingTimeCoverter}}"
                                                       FontSize="14"
                                                       TextColor="White"/>

                                            </VerticalStackLayout>

                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>

                
                    <!-- ARCHIVED VOTES -->
                    <VerticalStackLayout Spacing="10">
                        
                        <Label Text="Archived Votes"
                               FontSize="26"
                               TextColor="White"
                               HorizontalOptions="Center"/>
                        <Border StrokeThickness="1"/>
                        <CollectionView ItemsSource="{Binding ArchivedPolls}"
                                        SelectionMode="Single"
                                        SelectedItem="{Binding SelectedPoll, Mode=TwoWay}">
                            
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Border StrokeShape="RoundRectangle 20"
                                            StrokeThickness="2"
                                            Margin="10"
                                            Padding="20"
                                            BackgroundColor="SlateGray"
                                            Stroke="Transparent">

                                        
                                        <!-- WE NEED THIS FOR SELECTION HIGHLIGHT LOGIC -->
                                        <VisualStateManager.VisualStateGroups>
                                            <VisualStateGroup Name="CommonStates">
                                                <VisualState Name="Normal">
                                                    <VisualState.Setters>
                                                        <Setter Property="Stroke" Value="Transparent"/>
                                                    </VisualState.Setters>
                                                </VisualState>

                                                <VisualState Name="Selected">
                                                    <VisualState.Setters>
                                                        <Setter Property="Stroke" Value="BlueViolet"/>
                                                    </VisualState.Setters>
                                                </VisualState>
                                            </VisualStateGroup>
                                        </VisualStateManager.VisualStateGroups>
                                        

                                        <Grid ColumnDefinitions="*, Auto, Auto">
                                            <VerticalStackLayout Grid.Column="0">
                                                <Label Text="{Binding Title}"
                                                       FontSize="18"
                                                       TextColor="White"/>

                                                </VerticalStackLayout>

                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </ScrollView>
            </Border>

            <!-- RIGHT SIDE -->
            <VerticalStackLayout Grid.Column="2">
                <VerticalStackLayout Grid.Column="1"
                                     BindingContext="{Binding SelectedPoll}"
                                     IsVisible="{Binding ., Converter={StaticResource IsNotNullConverter}}">
                    

                    <Border  BackgroundColor="#20FFFFFF"
                             StrokeShape="RoundRectangle 40"
                             Padding="25"
                             StrokeThickness="0"
                             Margin="10, 0, 0, 0">

                        <VerticalStackLayout Spacing="15">
                            <Label Text="Selected Poll"
                                   FontSize="24"
                                   Padding="20"
                                   TextColor="White"/>
                            
                            <Border StrokeThickness="1"
                                    Stroke="Black"/>
                            
                            <Label Text="{Binding Title}"
                                   FontSize="50"
                                   TextColor="White"
                                   HorizontalOptions="Start"/>
                            
                            <Label Text="{Binding Description, StringFormat='Description: {0}'}" 
                                   HorizontalOptions="Start"
                                   FontAttributes="Italic"/>
                            
                            <Label Text="{Binding Created, StringFormat='Created: {0}'}"
                                   FontSize="14"
                                   TextColor="White"/>

                            <Label Text="{Binding Deadline, StringFormat='Deadline: {0}'}"
                                   FontSize="14"
                                   TextColor="White"/>
                            
                            <Border StrokeThickness="1"
                                    Stroke="Black"/>
                            
                            <StackLayout>
                                <VerticalStackLayout BindableLayout.ItemsSource="{Binding Options}" 
                                                     Spacing="10">
        
                                    <BindableLayout.ItemTemplate>
                                        <DataTemplate>
                                            <Border StrokeThickness="0" Padding="5">
                                                <RadioButton Content="{Binding Text}"
                                                             TextColor="White"
                                                             FontSize="16"
                                                             GroupName="MyPollOptions"
                                                             Value="{Binding .}"
                                                             CheckedChanged="OnOptionCheckedChanged"/>
                    
                                            </Border>
                                        </DataTemplate>
                                    </BindableLayout.ItemTemplate>
                                </VerticalStackLayout>
                                
                                <HorizontalStackLayout HorizontalOptions="End">
                                    <Button Text="Submit Vote"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type ViewModels:ListPollsViewModel}}, Path=SubmitVoteCommand}"/>
                                    
                                </HorizontalStackLayout>
                            </StackLayout>
                     </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>
            </VerticalStackLayout>
        </Grid>
    </Border>
</ContentPage>
